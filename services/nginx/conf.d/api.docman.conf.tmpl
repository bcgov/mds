# ----------------------------------------------------------------------
# | API endpoint                                                       |
# ----------------------------------------------------------------------

# Proxy incoming requests for /document-manager to the backend container

location ${PATH_PREFIX}/document-manager/ {
        if (-f /opt/app-root/src/html/maintenance_on.html){
                return 503;
        }

        proxy_pass ${DOCUMENT_MANAGER_SERVICE_URL}${PATH_PREFIX}/document-manager/;
        # Disable request and response buffering
        proxy_request_buffering  off;
        proxy_buffering          off;
        proxy_http_version       1.1;
        proxy_redirect     off;
        port_in_redirect   off;

        # Add X-Forwarded-* headers
        proxy_set_header X-Forwarded-Host $server_name;
        proxy_set_header X-Forwarded-Proto https;
        proxy_set_header X-Real-IP $remote_addr;

        proxy_set_header   Host $host;

        # proxy_set_header         Upgrade $http_upgrade;
        proxy_set_header         Connection "keep-alive";
        client_max_body_size     0;

        proxy_pass_request_headers on;
}

location ${PATH_PREFIX}/document-manager/v1/ {
        if (-f /opt/app-root/src/html/maintenance_on.html){
                return 503;
        }

        proxy_pass ${DOCUMENT_MANAGER_SERVICE_URL}${PATH_PREFIX}/document-manager/;
        # Disable request and response buffering
        proxy_request_buffering  off;
        proxy_buffering          off;
        proxy_http_version       1.1;
        proxy_redirect     off;
        port_in_redirect   off;

        # Add X-Forwarded-* headers
        proxy_set_header X-Forwarded-Host $server_name;
        proxy_set_header X-Forwarded-Proto https;
        proxy_set_header X-Real-IP $remote_addr;

        proxy_set_header   Host $host;

        # proxy_set_header         Upgrade $http_upgrade;
        proxy_set_header         Connection "keep-alive";
        client_max_body_size     0;

        proxy_pass_request_headers on;
}