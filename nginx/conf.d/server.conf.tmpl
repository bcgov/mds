server {
    listen       ${NGINX_PORT};
    listen       [::]:${NGINX_PORT};
    server_name  _;
    root         /opt/app-root/src;

    location ${PATH_PREFIX}/api {
        proxy_pass http://mds-python-backend-pr-345:5000${PATH_PREFIX};
        proxy_set_header   Host $host;
        proxy_set_header   X-Real-IP $remote_addr;
        proxy_set_header   X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header   X-Forwarded-Host $server_name;
        proxy_pass_request_headers on;
    }

    location ${PATH_PREFIX}/ {
        proxy_pass http://mds-frontend-pr-345:3000${PATH_PREFIX}/;
        proxy_buffering    off;
        proxy_redirect     off;
        proxy_set_header   Host $host;
        proxy_set_header   X-Real-IP $remote_addr;
        proxy_set_header   X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header   X-Forwarded-Host $server_name;
        proxy_pass_request_headers on;
    }

    # For status of ngnix service
    location /nginx_status {
        # Enable Nginx stats
        stub_status on;
        # Only allow access from localhost
        allow 127.0.0.1;
        # Other request should be denied
        deny all;
        # No need to log this request, its just noise
        access_log off;
    }

    error_page 404 /404.html;
    location = /40x.html {
    }

    error_page 500 502 503 504  /50x.html;
    location = /50x.html {
    }

}
